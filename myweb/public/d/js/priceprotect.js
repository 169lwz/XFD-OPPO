jQuery(document).ready(function(a){a(".ppn").click(function(){var b="";var c={};c.oi_id=a(this).data("itemid");a.ajax({url:"/ajax/price/apply_for_priceprotect",type:"POST",dataType:"json",data:c,success:function(d){if(d.code===1){d=d.info;b+='<div class="ppccentent ppcc">';b+='<div class="ppccDiv">';b+="<p>由于您的订单已确认签收，申请价格保护后，系统将立即为您发放以下差价现金券：</p>";b+='<div class="ppccentleft"><a href="/product/detail/'+d.sku+'.html" title="'+d.name+'" class="ppccentlefta_1"><img src="'+d.image+'" alt="'+d.name+'"></a></div>';b+='<div class="ppccentright">';b+="<p>"+d.name+"</p>";b+="<p>上次购买价： ￥"+d.deal_price+"</p>";b+="<p>当前销售价： ￥"+d.protect_price+"</p>";b+="<p>差&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价： ￥"+d.price_gap+"</p>";b+='<input type="hidden" id="oi_id" value="'+c.oi_id+'"/>';b+="</div>";b+="</div>";b+='<p><input type="checkbox" id="ppbox" class="ppbox"/><label for="ppbox" class="ppboxlabel">已阅读《价格保护说明》，同意现金券发放规则。</label></p>';b+='<p class="ppcorda"><input type="button" value="取消" id="deldialog"/><input type="button" value="确认申请" id="ppa"/></p>';b+='<div class="ppline"></div>';b+='<p class="ppordq">当该商品发生退货时，已经发放的代金券依然生效，商品的退款金额=支付金额-差价现金券金额。<a href="/Info/help/8" target="_blank">价格保护说明</a></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"申请价格保护",position:"center"}).dialog("open")}else{if(d.code===0){d=d.info;b+='<div class="ppccentent ppcc">';b+='<div class="ppccDiv">';b+='<div class="ppccentleft"><a href="/product/detail/'+d.sku+'.html" title="'+d.name+'" class="ppccentlefta_1"><img src="'+d.image+'" alt="'+d.name+'"></a></div>';b+='<div class="ppccentright">';b+="<p>"+d.name+"</p>";b+="<p>上次购买价： ￥"+d.deal_price+"</p>";b+="<p>当前销售价： ￥"+d.protect_price+"</p>";b+="<p>差&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价： ￥"+d.price_gap+"</p>";b+='<input type="hidden" id="oi_id" value="'+c.oi_id+'"/>';b+="</div>";b+="</div>";b+='<p class="ppcorda"><input type="button" value="取消" id="deldialog"/><input type="button" value="确认申请" id="ppa"/></p>';b+='<div class="ppline"></div>';b+='<p class="ppordq">申请价格保护成功后，订单需“确认签收”，差价将以全场通用现金券的形式发放到您的账户。<a href="/Info/help/8" target="_blank">价格保护说明</a></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"申请价格保护",position:"center"}).dialog("open")}else{b+='<div class="ppccentent ppcc">';b+='<p style="widht:450px;text-align:center;font-size:20px;margin-top:20px"><img src="'+cdn_url+'images/v6/usercenter/ppicon_2.png" />价格保护申请失败</p>';b+="<p>失败的原因：</p>";b+='<p style="text-indent: 2em;">该商品购买时与当前售价无差额</p>';b+='<p style="text-indent: 2em;">该商品购买时包含了赠品</p>';b+='<p style="text-indent: 2em;">该商品已经申请过价格保护</p>';b+='<p style="text-indent: 2em;">该商品当前不是可售状态</p>';b+='<p style="padding-bottom:20px;margin-bottom:20px"><a href="/Info/help/8" target="_blank">价格保护说明</a></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"价格保护申请失败",position:"center"}).dialog("open")}}}})});a("body").delegate("#ppa","click",function(){if(a("input").hasClass("ppbox")){if(a("#ppbox").attr("checked")){var b="";var c={};c.oi_id=a("#oi_id").val();a.ajax({url:"/ajax/price/confirm_apply",type:"POST",dataType:"json",data:c,success:function(d){if(d.code===0){a("#dialog").dialog("close");b+='<div class="ppccentent">';b+='<p style="margin-bottom:10px">已向您的账户发放面额为';b+=" ￥"+d.price+" ";b+="的差价现金券，请进入“我的账户-->代金券管理”中查看。</p>";b+='<p style="padding-bottom:20px;"><a href="/member/mycoupon" style="float:right" target="_blank">立即查看></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:400,title:"发放现金券",position:"center"}).dialog("open")}else{if(d.code===1){a("#dialog").dialog("close");b+='<div class="ppccentent ppcc">';b+='<p style="widht:450px;text-align:center;font-size:20px;margin-top:20px"><img src="'+cdn_url+'images/v6/usercenter/ppicon.png" />价格保护申请成功</p>';b+='<p style="line-height:40px">当您的订单操作“确认签收”后，系统将立即为您发放已申请的差价现金券。<a href="/Info/help/8" target="_blank">价格保护说明</a></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"价格保护申请成功",position:"center"}).dialog("open")}else{a("#dialog").dialog("close");b+='<div class="ppccentent ppcc">';b+='<p style="widht:450px;text-align:center;font-size:20px;margin-top:20px"><img src="'+cdn_url+'images/v6/usercenter/ppicon_2.png" />价格保护申请失败</p>';b+="<p>失败的原因：</p>";b+='<p style="text-indent: 2em;">该商品购买时与当前售价无差额</p>';b+='<p style="text-indent: 2em;">该商品购买时包含了赠品</p>';b+='<p style="text-indent: 2em;">该商品已经申请过价格保护</p>';b+='<p style="padding-bottom:20px;margin-bottom:20px"><a href="/Info/help/8" target="_blank">价格保护说明</a></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"价格保护申请失败",position:"center"}).dialog("open")}}}})}else{a(".ppboxlabel").css("color","red")}}else{var b="";var c={};c.oi_id=a("#oi_id").val();a.ajax({url:"/ajax/price/confirm_apply",type:"POST",dataType:"json",data:c,success:function(d){if(d.code===0){a("#dialog").dialog("close");b+='<div class="ppccentent">';b+='<p style="margin-bottom:10px">已向您的账户发放面额为';b+=" ￥"+d.price+" ";b+="的差价现金券，请进入“我的账户-->代金券管理”中查看。</p>";b+='<p style="padding-bottom:20px;"><a href="/member/mycoupon" style="float:right" target="_blank">立即查看></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:400,height:100,title:"发放现金券",position:"center"}).dialog("open")}else{if(d.code===1){a("#dialog").dialog("close");b+='<div class="ppccentent ppcc">';b+='<p style="widht:450px;text-align:center;font-size:20px;margin-top:20px"><img src="'+cdn_url+'images/v6/usercenter/ppicon.png" />价格保护申请成功</p>';b+='<p style="line-height:40px">当您的订单操作“确认签收”后，系统将立即为您发放已申请的差价现金券。<a href="/Info/help/8" target="_blank">价格保护说明</a></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"价格保护申请成功",position:"center"}).dialog("open")}else{a("#dialog").dialog("close");b+='<div class="ppccentent ppcc">';b+='<p style="widht:450px;text-align:center;font-size:20px;margin-top:20px"><img src="'+cdn_url+'images/v6/usercenter/ppicon_2.png" />价格保护申请失败</p>';b+="<p>失败的原因：</p>";b+='<p style="text-indent: 2em;">该商品购买时与当前售价无差额</p>';b+='<p style="text-indent: 2em;">该商品购买时包含了赠品</p>';b+='<p style="text-indent: 2em;">该商品已经申请过价格保护</p>';b+='<p style="padding-bottom:20px;margin-bottom:20px"><a href="/Info/help/8" target="_blank">价格保护说明</a></p>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"价格保护申请失败",position:"center"}).dialog("open")}}}})}});a(".ppc").click(function(){var b={};b.ordercode=a("#ordercode").html();a.ajax({url:"/ajax/price/get_order_info",type:"POST",dataType:"json",data:b,success:function(e){var d="";if(e.code===1){d+='<div class="ppccentent ppcord"><p>请务必在您收到全部货物以后再确认签收！</p>';d+='<p style="margin-top:5px">由于您的订单申请过价格保护，确认签收后，系统将立即为您发放以下差价现金券：</p>';d+="<table>";for(var c=0;c<e.info.length;c++){d+="<tr>";d+='<td class="ppctd_1" width="70"><a href=""><img src="'+e.info[c].image+'"></a></td>';d+="<td>"+e.info[c].name+"</td>";d+='<td width="140" class="ppctd_3">差价：￥&nbsp;'+e.info[c].price+"</td>";d+="</tr>"}d+="</table>";d+='<p><input type="checkbox" id="ppbox" class="ppbox" /><label for="ppbox" class="ppboxlabel">已阅读《价格保护说明》，同意现金券发放规则。</label></p>';d+='<p class="ppcordP"><input type="button" value="取消" id="deldialog"/><input type="button" value="确认签收" id="ppc"/></p>';d+='<div class="ppline"></div>';d+='<p class="ppordq">当该商品发生退货时，已经发放的现金券依然生效，商品的退款金额=支付金额-差价现金券金额。<a href="/Info/help/8" target="_blank" style="float:right">价格保护说明</a></p>';d+="</div>"}else{if(e.code===0){d+='<div class="ppccentent ppcord"><p>请务必在您收到全部货物以后再确认签收！</p>';d+='<p class="ppcordP"><input type="button" value="取消" id="deldialog"/><input type="button" value="确认签收" id="ppc"/></p>';d+="</div>"}else{d+='<div class="ppccentent ppcord"><p>确认签收失败，请稍后重试。</p>';d+="</div>"}}a("#dialog").html(d);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"确认签收",position:"center"}).dialog("open")}})});a("body").delegate("#deldialog","click",function(){a("#dialog").dialog("close")});a("body").delegate("#ppc","click",function(){if(a("input").hasClass("ppbox")){if(a("#ppbox").attr("checked")){a("#dialog").dialog("close");var b={};b.ordercode=a("#ordercode").html();a.ajax({url:"/ajax/price/confirm_order_receive",type:"POST",dataType:"json",data:b,success:function(e){var d="";if(e.code===1){d+='<div class="ppccentent">';d+="<p></a>已向您的账户发放面额为";for(var c=0;c<e.price.length;c++){d+="￥"+e.price[c]+"，"}d+="的差价现金券，请进入“我的账户-->代金券管理”中查看。</p>";d+='<p style="padding-bottom:20px;"><a href="/member/mycoupon" style="float:right"  target="_blank">立即查看></p>';d+="</div>";a(".ppcOut").remove();a("#dialog").html(d);setTimeout(function(){a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:400,title:"发放现金券",position:"center"}).dialog("open")},1000)}else{if(e.code===0){setTimeout(function(){a(".ppcOut").remove();a("#dialog").dialog("close");a("#pporderqs").html("已签收")},1000)}else{d+='<div class="ppccentent ppcord"><p>确认签收失败，请稍后重试。</p>';d+="</div>";a("#dialog").html(d);setTimeout(function(){a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"确认签收失败",position:"center"}).dialog("open")},1000)}}window.location.reload()}})}else{a(".ppboxlabel").css("color","red")}}else{a("#dialog").dialog("close");var b={};b.ordercode=a("#ordercode").html();a.ajax({url:"/ajax/price/confirm_order_receive",type:"POST",dataType:"json",data:b,success:function(e){var d="";if(e.code===1){d+='<div class="ppccentent">';d+="<p></a>已向您的账户发放面额为";for(var c=0;c<e.price.length;c++){d+="￥"+e.price[c]+"，"}d+="的差价现金券，请进入“我的账户-->代金券管理”中查看。</p>";d+='<p style="padding-bottom:20px;"><a href="/member/mycoupon" style="float:right"  target="_blank">立即查看></p>';d+="</div>";a(".ppcOut").remove();a("#dialog").html(d);setTimeout(function(){a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:400,title:"发放现金券",position:"center"}).dialog("open")},1000)}else{if(e.code===0){setTimeout(function(){a(".ppcOut").remove();a("#dialog").dialog("close");a("#pporderqs").html("已签收")},1000)}else{d+='<div class="ppccentent ppcord"><p>确认签收失败，请稍后重试。</p>';d+="</div>";a("#dialog").html(d);setTimeout(function(){a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:500,title:"确认签收失败",position:"center"}).dialog("open")},1000)}}window.location.reload()}})}});a(".ppd").click(function(){var c=a(this).closest("td").attr("data-id");var b="";b+='<div class="ppccentent">';b+="<p>确认取消该价格保护申请?</p>";b+='<input type="hidden" value="'+c+'" id="ppid"/>';b+='<input type="button" value="否" id="deldialog"/><input type="button" value="是" id="ppdt"/>';b+="</div>";a("#dialog").html(b);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:400,height:150,title:"取消价格保护申请",position:"center"}).dialog("open")});a("body").delegate("#ppdt","click",function(){var b={};b.id=a("#ppid").val();a.ajax({url:"/ajax/price/cancelPriceprotect",type:"POST",dataType:"json",data:b,success:function(d){if(d.code===0){a("#"+b.id+"").closest("tr").find(".retStatusInfo").html("已取消");a("#"+b.id+"").closest("tr").find(".ppdtd").html("--");a("#dialog").dialog("close")}else{var c="";c+='<div class="ppccentent">';c+="<p>取消失败，请稍后重试</p>";c+="</div>";a("#dialog").html(c);a("#dialog").dialog({autoOpen:true,closeOnEscape:true,modal:true,width:400,height:150,title:"取消失败",position:"center"}).dialog("open")}}})})});