jQuery(function(e){e(".prolist-main .gl-item").delegate(".gl-img","mouseenter",function(){var l=e(this);var j=l.closest("li");if(!j.hasClass("over")){j.addClass("over")}var k=j.find(".gl-price .okprice").attr("id");j.find(":animated").stop();i(j,k)});e(".prolist-main .gl-item").delegate(".gl-img","mouseleave",function(){var j=e(this);j.find(".pdImgB").stop().fadeTo(150,0,function(){j.find(".pdImgB").removeAttr("style")});j.find(".pdImg").stop().fadeTo(10,1,function(){j.find(".pdImg").removeAttr("style")})});function i(k,l){if(k.hasClass("over")){var j=k.find(".pdImgB");j.attr("src",j.attr("original"));k.find(".pdImgB").stop().removeAttr("style").fadeIn(150);k.find(".pdImg").stop().removeAttr("style").fadeOut(10)}else{k.find(":animated").stop().attr("style","")}}e("body").delegate(".emore","click",function(k){k.preventDefault();var l=e(this);var j=l.closest(".filter-con");if(l.hasClass("show-all")){j.attr("style","height:auto");l.removeClass("show-all").addClass("hide-part").html('收起<span class="trige"></span>')}else{if(j.find(".selectmore").hide()){if(l.hasClass("js-more")){l.removeClass("js-more");l.hide()}j.find(".selectmore").show();j.find(".checkmore-result").hide();j.find(".filter-item a").removeClass("sel-cur");j.find(".filter-all a").addClass("check")}if(j.find(".height").val()=="1"){j.attr("style","height:28px")}else{j.attr("style","height:56px")}l.removeClass("hide-part").addClass("show-all").html('更多<span class="trige"></span>')}});e("body").delegate(".selectmore","click",function(l){l.preventDefault();var m=e(this);var k=m.closest(".filter-con");var j=k.find(".emore");k.attr("style","height:auto");if(j.hasClass("show-all")){j.removeClass("show-all").html('收起<span class="trige"></span>');if(j.css("display")=="none"){j.addClass("hide-part js-more")}else{j.addClass("hide-part")}j.show()}k.find(".filter-all a").removeClass("check");k.find(".checkmore-result").attr("style","display:block");m.hide()});e("body").delegate(".calbtn","click",function(k){k.preventDefault();var l=e(this);var j=l.closest(".filter-con");if(j.find(".emore").hasClass("js-more")){j.find(".emore").removeClass("hide-part js-more").addClass("show-all").html('更多<span class="trige"></span>');j.find(".emore").hide()}else{j.find(".emore").addClass("show-all").removeClass("hide-part").html('更多<span class="trige"></span>')}j.find(".selectmore").show();j.find(".checkmore-result").hide();if(j.find(".height").val()=="1"){j.attr("style","height:28px")}else{j.attr("style","height:56px")}j.find(".filter-all a").addClass("check");j.find(".filter-item a").removeClass("sel-cur")});e("body").delegate(".mbtn","click",function(l){l.preventDefault();var m=e(this);var j=m.closest("#selector").find(".js-hide");var k=e("#hidestatus").val();if(k==="0"){j.show();m.html('收起<span class="upicon"></span>');k="1";e("#hidestatus").val("1")}else{j.hide();m.html('更多<span class="micon"></span>');k="0";e("#hidestatus").val("0")}});e("body").delegate(".filter-item a","click",function(k){k.preventDefault();var m=e(this);if(m.closest(".filter-con").find(".selectmore").css("display")=="none"){if(m.hasClass("sel-cur")){m.removeClass("sel-cur");if(m.closest(".filter-con").find(".sel-cur").length===0){m.closest(".filter-list").find(".subtn").addClass("sub-none");m.closest(".filter-list").find("#category_btn").addClass("sub-none")}}else{if(m.closest(".filter-con").find(".sel-cur").length>=5){alert("最多5个");return false}else{m.addClass("sel-cur");m.closest(".filter-list").find(".subtn").removeClass("sub-none");m.closest(".filter-list").find("#category_btn").removeClass("sub-none")}}}else{m.closest(".filter-con").find(".filter-all a").removeClass("check");var j=e(k.target).attr("val");var l=m.attr("name");m.addClass("sel-cur");e("#searchsort").val("");e("#search"+l).val(j);g()}});e("body").delegate(".color-item a","click",function(k){k.preventDefault();var m=e(this);m.closest(".filter-con").find(".filter-all a").removeClass("check");var j=e(k.target).attr("val");var l=m.attr("name");e("#searchsort").val("");e("#search"+l).val(j);g()});e("body").delegate(".subtn","click",function(m){m.preventDefault();var p=e(this);var l=e(this).closest(".filter-list").find(".filter-item a");_checkitem=e(this).closest(".filter-list").find(".filter-item .sel-cur");var j=[],o;if(l.hasClass("sel-cur")){o=_checkitem.attr("name");for(var k=0;k<_checkitem.length;k++){j[k]=_checkitem.eq(k).attr("val")}var n=j.join(",");e("#search"+o).val(n);e("#searchsort").val("");g()}});e("body").delegate("#category_btn","click",function(r){r.preventDefault();var q=e(this);var s=e(this).closest(".filter-list").find(".filter-item a");_checkitem=e(this).closest(".filter-list").find(".filter-item .sel-cur");var y=[],x=[],v=[],n=[],u=[],l=[],t=[],j=[],p,m,k;var w=j2=j3=0;if(s.hasClass("sel-cur")){for(var o=0;o<_checkitem.length;o++){x[o]=_checkitem.eq(o).attr("name");y[o]=_checkitem.eq(o).attr("val");if(x[o].indexOf("first")>-1){v[w]=x[o];n[w]=y[o];w++}if(x[o].indexOf("second")>-1){u[j2]=x[o];l[j2]=y[o];j2++}if(x[o].indexOf("third")>-1){t[j3]=x[o];j[j3]=y[o];j3++}}if(n.length>0){p=n.join(",")}if(l.length>0){m=l.join(",")}if(j.length>0){k=j.join(",")}e("#search"+v).val(p);e("#search"+u).val(m);e("#search"+t).val(k);e("#searchsort").val("");g()}});e("body").delegate(".fpricebtn","click",function(l){l.preventDefault();var o=e(this);var n=e(this).closest(".filter-con").find(".fprice-num");var j=[],m=[];m[0]=n.eq(0).attr("name");m[1]=n.eq(1).attr("name");if(n.eq(0).val()!=""||n.eq(1).val()!=""){if(n.eq(0).val()===""){j[1]=parseInt(n.eq(1).val());e("#search"+m[1]).val(j[1])}else{if(n.eq(1).val()===""){j[0]=parseInt(n.eq(0).val());e("#search"+m[0]).val(j[0])}else{j[0]=parseInt(n.eq(0).val());j[1]=parseInt(n.eq(1).val());if(j[0]>j[1]){var k=j[1];j[1]=j[0];j[0]=k}e("#search"+m[0]).val(j[0]);e("#search"+m[1]).val(j[1])}}e("#searchsort").val("");g()}});e("body").delegate(".tag-delete","click",function(j){j.preventDefault();var l=e(this);var k=e(this).closest(".bread-item").attr("name");if(k.indexOf("price_rage")>-1){e("#searchlow_price").val("");e("#searchhigh_price").val("")}else{e("#search"+k).val("")}g()});e(".prolist-head .pro-tab a").click(function(k){var j=e(k.target).attr("val");var l=e(k.target).attr("name");e("#search"+l).val(j);g()});b();function b(){var k=f("sort");if(k){var j=e("#listheader").offset().top;e("html,body").animate({scrollTop:j},1000)}}function f(j){var k=new RegExp("(^|&)"+j+"=([^&]*)(&|$)");var l=window.location.search.substr(1).match(k);if(l!=null){return unescape(l[2])}return null}e("#instock_check").click(function(k){var j=e(this).is(":checked");if(j){e("#searchstock").val("1")}else{e("#searchstock").val("0")}g()});function g(){e("#searchform input[type='hidden']").each(function(){if(e(this).val()===""){e(this).remove()}});setTimeout(function(){e("#searchform").submit()},0)}e("#next_page_a, #prev_page_a, #propage-btn").click(function(){var l=e(this).attr("page_num");var k=e('input[name="base_url"]').val();var m;if(k.indexOf("?")>-1){m=k+"&per_page="}else{m=k+"?per_page="}var j=parseInt(e('input[name="num_pages"]').val());if(typeof l==="undefined"){l=e(".prolist-page .input-txt").val()}l=parseInt(l);if(!l){return}if(l<=0){l=1}if(l>j){l=j}if(l!=1){location.href=m+l+"#listheader"}else{location.href=m+l}});var h=e("[id^=js-promotion]");var d=[];h.each(function(){d.push(e(this).attr("comid"))});if(d.length===0){return false}var c=d.join("-");e.ajax({url:"/ajax/product/get_new_list_price?"+Math.random(),context:document.body,type:"GET",data:{comids:c},dataType:"json",success:function(l){if(l.code===1){okprice=l.data;var k=e(".gl-item");for(var j in okprice){if(parseInt(k.eq(j).attr("comid"))===okprice[j].sku){k.eq(j).find(".okprice").text(okprice[j].sale_price);k.eq(j).find(".market-price").text(okprice[j].market_price);k.eq(j).find(".oksale em").text(okprice[j].dis)}}}}});e.ajax({url:"/ajax/product/get_com_promotion?"+Math.random(),context:document.body,type:"GET",data:{comids:c},dataType:"json",success:function(l){if(l.code===1){promotion=l.data;var k=e(".gl-item");for(var j in promotion){if(parseInt(k.eq(j).attr("comid"))===promotion[j].sku){if(promotion[j].typeName!=""&&promotion[j].name!=""){k.eq(j).find(".gl-sale-info").html('<span class="sale-tag">'+promotion[j].typeName+"</span>"+promotion[j].name+"").css("visibility","visible")}}}}}});if(e("#temaiID").length>0){var a={};a={outletsid:e("#temaiID").val(),comids:c};e.ajax({url:"/ajax/product/get_stock?"+Math.random(),context:document.body,type:"GET",data:a,dataType:"json",success:function(l){if(l.code===1){if(l.type==="soon"){e(".proliststart").show()}else{if(l.type==="end"){e(".prolistover").show()}else{if(l.type==="other"||l.type==="ongoing"){sq=l.data;var k=e(".gl-item");for(var j in sq){if(parseInt(k.eq(j).attr("comid"))===sq[j].sku){if(sq[j].stock==0||sq[j].temp_stock==0){k.eq(j).append('<div class="prolistsq"></div>')}}}}}}}}})}});